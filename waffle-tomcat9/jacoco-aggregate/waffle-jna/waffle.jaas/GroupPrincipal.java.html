<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>GroupPrincipal.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">waffle-tomcat9</a> &gt; <a href="../index.html" class="el_bundle">waffle-jna</a> &gt; <a href="index.source.html" class="el_package">waffle.jaas</a> &gt; <span class="el_source">GroupPrincipal.java</span></div><h1>GroupPrincipal.java</h1><pre class="source lang-java linenums">/**
 * Waffle (https://github.com/Waffle/waffle)
 *
 * Copyright (c) 2010-2020 Application Security, Inc.
 *
 * All rights reserved. This program and the accompanying materials are made available under the terms of the Eclipse
 * Public License v1.0 which accompanies this distribution, and is available at
 * https://www.eclipse.org/legal/epl-v10.html.
 *
 * Contributors: Application Security, Inc.
 */
package waffle.jaas;

import java.security.Principal;
import java.security.acl.Group;
import java.util.Collection;
import java.util.Collections;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.Map;

/**
 * Group principal.
 *
 * @author rockchip[dot]tv[at]gmail[dot]com
 */
// TODO: Review replacement options for 'Group' as it is officially removed from jdk 14. See
// https://bugs.openjdk.java.net/browse/JDK-8217101?attachmentOrder=desc.
public class GroupPrincipal extends UserPrincipal implements Group {

    /** The Constant serialVersionUID. */
    private static final long serialVersionUID = 1L;

    /** The fqn. */
    private final String fqn;

    /** A list of fqn members for this group. */
    private final Map&lt;Principal, Principal&gt; members;

    /**
     * Instantiates a new group principal.
     *
     * @param fqn
     *            the fqn
     */
    public GroupPrincipal(final String fqn) {
<span class="fc" id="L47">        super(fqn);</span>

<span class="fc" id="L49">        this.fqn = fqn;</span>
<span class="fc" id="L50">        this.members = new HashMap&lt;&gt;();</span>
<span class="fc" id="L51">    }</span>

    @Override
    public String getName() {
<span class="fc" id="L55">        return this.fqn;</span>
    }

    @Override
    public boolean addMember(final Principal user) {
<span class="fc" id="L60">        final boolean isMember = this.members.containsKey(user);</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">        if (!isMember) {</span>
<span class="fc" id="L62">            this.members.put(user, user);</span>
        }
<span class="fc" id="L64">        return isMember;</span>
    }

    @Override
    public boolean isMember(final Principal user) {
<span class="fc" id="L69">        boolean isMember = this.members.containsKey(user);</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (!isMember) {</span>
<span class="nc" id="L71">            final Collection&lt;Principal&gt; values = this.members.values();</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            for (final Principal principal : values) {</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">                if (principal instanceof Group) {</span>
<span class="nc" id="L74">                    final Group group = (Group) principal;</span>
<span class="nc" id="L75">                    isMember = group.isMember(user);</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">                    if (isMember) {</span>
<span class="nc" id="L77">                        break;</span>
                    }
                }
<span class="nc" id="L80">            }</span>
        }
<span class="fc" id="L82">        return isMember;</span>
    }

    @Override
    public Enumeration&lt;? extends Principal&gt; members() {
<span class="fc" id="L87">        return Collections.enumeration(this.members.values());</span>
    }

    @Override
    public boolean removeMember(final Principal user) {
<span class="nc" id="L92">        final Object prev = this.members.remove(user);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        return prev != null;</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L98">        final StringBuilder tmp = new StringBuilder(this.getName());</span>
<span class="nc" id="L99">        tmp.append(&quot;(members:&quot;);</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">        for (final Principal principal : this.members.keySet()) {</span>
<span class="nc" id="L101">            tmp.append(principal);</span>
<span class="nc" id="L102">            tmp.append(',');</span>
<span class="nc" id="L103">        }</span>
<span class="nc" id="L104">        tmp.setCharAt(tmp.length() - 1, ')');</span>
<span class="nc" id="L105">        return tmp.toString();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>